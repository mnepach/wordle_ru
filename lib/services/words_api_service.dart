import 'dart:convert';
import 'package:http/http.dart' as http;
import 'dart:math';

// Сервис для получения реальных русских слов
class WordsApiService {
  // Статический кэш слов для оффлайн работы
  static List<String> _cachedWords = [];
  static bool _isInitialized = false;

  // Инициализация - загрузка слов из русского словаря
  static Future<void> initialize() async {
    if (_isInitialized) return;

    try {
      // Используем API для получения русских слов из 5 букв
      final response = await http.get(
        Uri.parse('https://raw.githubusercontent.com/danakt/russian-words/master/russian.txt'),
      ).timeout(const Duration(seconds: 5));

      if (response.statusCode == 200) {
        final allWords = LineSplitter.split(response.body);

        // Фильтруем только слова из 5 букв, заглавными буквами
        _cachedWords = allWords
            .where((word) => word.length == 5 && RegExp(r'^[А-ЯЁа-яё]+$').hasMatch(word))
            .map((word) => word.toUpperCase())
            .toSet() // Убираем дубликаты
            .toList();

        // Если получилось мало слов, добавляем резервные
        if (_cachedWords.length < 100) {
          _cachedWords.addAll(_fallbackWords);
          _cachedWords = _cachedWords.toSet().toList();
        }
      } else {
        _cachedWords = List.from(_fallbackWords);
      }
    } catch (e) {
      print('Error loading words from API: $e');
      _cachedWords = List.from(_fallbackWords);
    }

    _isInitialized = true;
  }

  // Получить случайное слово для игры
  static String getRandomWord() {
    if (_cachedWords.isEmpty) {
      return _fallbackWords[Random().nextInt(_fallbackWords.length)];
    }
    return _cachedWords[Random().nextInt(_cachedWords.length)];
  }

  // Получить слово дня
  static String getWordOfTheDay() {
    if (_cachedWords.isEmpty) {
      final daysSinceEpoch = DateTime.now().difference(DateTime(2024, 1, 1)).inDays;
      return _fallbackWords[daysSinceEpoch % _fallbackWords.length];
    }

    final daysSinceEpoch = DateTime.now().difference(DateTime(2024, 1, 1)).inDays;
    return _cachedWords[daysSinceEpoch % _cachedWords.length];
  }

  // Проверить, существует ли слово
  static bool isValidWord(String word) {
    if (_cachedWords.isEmpty) {
      return _fallbackWords.contains(word.toUpperCase());
    }
    return _cachedWords.contains(word.toUpperCase()) ||
        _fallbackWords.contains(word.toUpperCase());
  }

  // Резервные слова на случай проблем с API (реальные русские слова из 5 букв)
  static final List<String> _fallbackWords = [
    'АРБУЗ', 'БЕЛКА', 'ВЕДРО', 'ГОРОД', 'ДОСКА',
    'ЖИЗНЬ', 'ЗАМОК', 'КНИГА', 'ЛИНИЯ', 'МЕСТО',
    'НАРОД', 'ОБРАЗ', 'ПРАВО', 'СЛОВО', 'ТОЧКА',
    'ФРАЗА', 'ШКОЛА', 'ОТВЕТ', 'ВРЕМЯ', 'РЫНОК',
    'СТЕНА', 'РУЧКА', 'ОКЕАН', 'ПАЛКА', 'МОЛОТ',
    'КИСТЬ', 'БАНКА', 'ЛОДКА', 'ПЕСОК', 'ВЕТЕР',
    'ГРОЗА', 'ЗАВОД', 'КАРТА', 'МЕТОД', 'НОМЕР',
    'ОЗЕРО', 'ПЕСНЯ', 'РАМКА', 'СУМКА', 'ТАНЕЦ',
    'БАГАЖ', 'БАЛЕТ', 'БЕРЕГ', 'БИЛЕТ', 'БЛЮДО',
    'БОКАЛ', 'ВЕСНА', 'ВИЗИТ', 'ВОЙНА', 'ВЫБОР',
    'ВЫЗОВ', 'ВЫХОД', 'ГЕРОЙ', 'ГЛАВА', 'ГОСТЬ',
    'ГРУППА', 'ДЕВИЗ', 'ДЕКОР', 'ДИВАН', 'ДОМИК',
    'ДОРОГА', 'ДОЧКА', 'ДРАМА', 'ДРОВА', 'ЗАБОР',
    'ЗАВЕТ', 'ЗАГАР', 'ЗАЛИВ', 'ЗАПАХ', 'ЗАРЯД',
    'ЗВЕНО', 'ЗЕМЛЯ', 'ЗНАТЬ', 'ИДЕАЛ', 'ИКОНА',
    'ИМИДЖ', 'КАЗАК', 'КАЛАЧ', 'КАНАЛ', 'КАССА',
    'КАТЕР', 'КНЯЗЬ', 'КОЛЕСО', 'КОФЕ', 'КРАЙ',
    'КРЕСТ', 'КРОВЬ', 'КРУГ', 'КУПЕЦ', 'КУРС',
    'КУСОК', 'ЛАМПА', 'ЛЕВЫЙ', 'ЛЕНТА', 'ЛИДЕР',
    'ЛИСТ', 'ЛОГИК', 'ЛОЖКА', 'МАСЛО', 'МАТЧ',
    'МЕДАЛЬ', 'МЕСЯЦ', 'МЕТАЛЛ', 'МЕТКА', 'МЕЧТА',
    'МНОГО', 'МОДЕЛЬ', 'МОЛОД', 'МОНАХ', 'МОРОЗ',
    'МОТИВ', 'НАВЫК', 'НАРЯД', 'НЕБО', 'НИТКА',
    'ОБИДА', 'ОБЛИК', 'ОБРЯД', 'ОГОНЬ', 'ОПЕРА',
    'ОРДЕН', 'ОСНОВ', 'ОТДЕЛ', 'ОТЗЫВ', 'ОТРЯД',
    'ОЧЕРК', 'ПАКЕТ', 'ПАПКА', 'ПАРАД', 'ПАРК',
    'ПАРТИЯ', 'ПАСХА', 'ПАТРОН', 'ПЕНАЛ', 'ПЕРЕЦ',
    'ПЕЧАТЬ', 'ПИРАТ', 'ПЛАТА', 'ПЛЕМЯ', 'ПЛИТА',
    'ПОБЕД', 'ПОВОД', 'ПОЕЗД', 'ПОКАЗ', 'ПОЛЕТ',
    'ПОЛКА', 'ПОЛЮС', 'ПОРТР', 'ПОСОЛ', 'ПОТОК',
    'ПОЧТА', 'ПРЕСС', 'ПРИЕМ', 'ПРИНЦ', 'ПТИЦА',
    'ПУТЬ', 'ПУШКА', 'ПЬЕСА', 'ПЯТНО', 'РАБОТ',
    'РАДИО', 'РАЙОН', 'РАНГ', 'РЕЧКА', 'РОМАН',
    'РУБЕЖ', 'РУБЛЬ', 'РУКАВ', 'РУЛЕТ', 'РЫБАК',
    'РЯДОМ', 'САХАР', 'СВЕЧА', 'СВЯЗЬ', 'СЕВЕР',
    'СЕМЬЯ', 'СЕСТР', 'СЕТЬ', 'СИЛА', 'СИСТЕ',
    'СКАЗК', 'СКАЛА', 'СКЛАД', 'СЛАВА', 'СЛЕД',
    'СЛУЖБ', 'СМЫСЛ', 'СНЕГ', 'СОБОР', 'СОВЕТ',
    'СОЮЗ', 'СПИНА', 'СПОРТ', 'СРЕДА', 'СТАДО',
    'СТАТЬ', 'СТИЛЬ', 'СТРАХ', 'СТУДЕ', 'СТУЛЬ',
    'СЦЕНА', 'ТАБАК', 'ТАЙНА', 'ТАКСИ', 'ТАНК',
    'ТАРИФ', 'ТЕАТР', 'ТЕЗИС', 'ТЕКСТ', 'ТЕЛЕГ',
    'ТЕЛЕФ', 'ТЕЛО', 'ТЕМА', 'ТЕОРИ', 'ТЕХНИ',
    'ТОВАР', 'ТОЛПА', 'ТОМИК', 'ТРАВМ', 'ТРАНС',
    'ТРАТА', 'ТРЕТЬ', 'ТРУБА', 'ТРУД', 'ТРУП',
    'ТУМАН', 'ТЮРЬМ', 'УДАЧА', 'УЖИН', 'УЛИЦА',
    'УРОВН', 'УСЛОВ', 'УСПЕХ', 'УСТАВ', 'УЧАСТ',
    'УЧЕНИ', 'ФАБРИ', 'ФАКТО', 'ФАМИЛ', 'ФЕРМА',
    'ФИГУР', 'ФИЗИК', 'ФИЛЬМ', 'ФИНАЛ', 'ФИРМА',
    'ФЛАГ', 'ФЛОТА', 'ФОНАР', 'ФОРМА', 'ФОТОГ',
    'ФРАНЦ', 'ФРОНТ', 'ФРУКТ', 'ХОЛОД', 'ХРАМ',
    'ЦЕЛЬ', 'ЦЕНТР', 'ЦЕПЬ', 'ЦИКЛ', 'ЦИРК',
    'ЧАСОВ', 'ЧАСТЬ', 'ЧАШКА', 'ЧЕСТЬ', 'ЧИСЛО',
    'ЧИТАТ', 'ЧЛЕН', 'ЧУВСТ', 'ЧУЖОЙ', 'ШАНС',
    'ШАПКА', 'ШАХТА', 'ШОССЕ', 'ШПАГА', 'ШТАБ',
    'ШТАМП', 'ШТАТ', 'ШТОРА', 'ШТРАФ', 'ШУТКА',
    'ЩЕНОК', 'ЭКРАН', 'ЭПОХА', 'ЭТАЖ', 'ЮБКА',
    'ЮЖНЫЙ', 'ЮМОР', 'ЮНОША', 'ЯГОДА', 'ЯЗЫК',
    'ЯЙЦО', 'ЯРУС', 'ЯЩИК', 'АБЗАЦ', 'АКТИВ',
    'АЛЬБО', 'АНАЛИЗ', 'АРХИВ', 'АТАКА', 'БАНЯ',
    'БАССЕ', 'БИТВА', 'БРОВЬ', 'БРЮКИ', 'БУМАГ',
    'ВАГОН', 'ВАЖНО', 'ВАННА', 'ВДОВА', 'ВЕЗДЕ',
    'ВЕРБА', 'ВЕРНО', 'ВЕРСТ', 'ВЕРШИН', 'ВЕЧЕР',
    'ВЕЩЬ', 'ВЗГЛЯ', 'ВЗЛЕТ', 'ВЗРЫВ', 'ВИДЕО',
    'ВИЛКА', 'ВИШНЯ', 'ВКЛАДЕ', 'ВКУС', 'ВЛАГА',
    'ВЛАСТ', 'ВМЕСТЕ', 'ВНИЗУ', 'ВНИЗ', 'ВНУК',
    'ВОДКА', 'ВОЗДУ', 'ВОЗЛЕ', 'ВОЙНА', 'ВОЛНА',
    'ВОЛОС', 'ВОРОН', 'ВОРОТА', 'ВОРОТ', 'ВРАГ',
    'ВРАЖД', 'ВРАТА', 'ВРЕМЯ', 'ВЧЕРА', 'ВЪЕЗД',
    'ВЫБРА', 'ВЫГОД', 'ВЫЕЗД', 'ВЫЗВА', 'ВЫПОЛ',
    'ВЫРВА', 'ВЫРАБ', 'ВЫРАЗ', 'ВЫСЛА', 'ВЫСОК',
    'ВЫСТУ', 'ВЫХОД', 'ВЫЧЕТ', 'ВЯЗКА', 'ГАВАНЬ',
    'ГАЗЕТ', 'ГАРАЖ', 'ГЕНЕР', 'ГЕНИЙ', 'ГИБЕЛ',
    'ГИМН', 'ГИТАР', 'ГЛАДК', 'ГЛИНА', 'ГЛУБО',
    'ГНАТЬ', 'ГНЕЗД', 'ГНИТЬ', 'ГОВОР', 'ГОЛЛА',
    'ГОЛОВ', 'ГОЛОД', 'ГОЛОС', 'ГОЛУБ', 'ГОЛЫЙ',
    'ГОНКА', 'ГОРА', 'ГОРАЗ', 'ГОРЕ', 'ГОРЛО',
    'ГОРН', 'ГОРСТ', 'ГОРЯЧ', 'ГОСТЕ', 'ГОСУД',
    'ГОТОВ', 'ГРАБИ', 'ГРАММ', 'ГРАНД', 'ГРАНИ',
    'ГРАФА', 'ГРАФИК', 'ГРАФИН', 'ГРЕМЕ', 'ГРЕХ',
    'ГРЕЧА', 'ГРИВА', 'ГРИМ', 'ГРИПП', 'ГРОБ',
    'ГРОМ', 'ГРОМК', 'ГРОШ', 'ГРУБО', 'ГРУДН',
    'ГРУДЬ', 'ГРУЗ', 'ГРУНТ', 'ГРУСТ', 'ГРУША',
    'ГРЯЗН', 'ГРЯЗЬ', 'ГУБА', 'ГУБЕР', 'ГУБИТ',
    'ГУБКА', 'ГУДОК', 'ГУЛЯН', 'ГУСТО', 'ГУСЬ'
  ];
}